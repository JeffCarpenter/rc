#!/bin/zsh







pkill gnome-keyring

# pkill dbus-daemon

if [ ${SSH_AGENT_PID+1} == 1 ]; then
    ssh-add -D
    ssh-agent -k > /dev/null 2>&1
    kill $SSH_AGENT_PID
    unset SSH_AGENT_PID
    unset SSH_AUTH_SOCK
    # it kill all other login's ssh-agent
    # pkill ssh-agent
fi


~/bin/syncimap -d               # it only get secinfo from x keyring; disable

foreach prog (
    ## it is automatically started by gdm, so no need to start it.
    # gnome-keyring-daemon
    xautolock
    ) {
        echo A DBUS >&2
        pgrep -l dbus-daemon >&2

        echo $prog
        whence -p $prog &&
        pgrep $prog[0,15] && pkill $prog[0,15]

        echo B DBUS >&2
        pgrep -l dbus-daemon >&2

    }



__comp=xlogout


if [ -d ~/.rsetup/${__comp}/run.d/${HOST} ] ; then
    rm -rf ~/.rsetup/${__comp}/run.d/${HOST}
fi
if [ ! -x ~/.rsetup/${__comp}/run.d/${HOST} ] ; then
    mkdir ~/.rsetup/${__comp}/run.d/
    cp ~/.rsetup/${__comp}/run.tmpl ~/.rsetup/${__comp}/run.d/${HOST}
fi

if [ -r ~/.rsetup/${__comp}/run.d/${HOST} ] ; then
    ~/.rsetup/${__comp}/run.d/${HOST}
fi

unset __comp
